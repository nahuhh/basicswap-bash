#!/bin/bash
source $HOME/.local/bin/bsx/shared.sh

is_running
is_tails

# Cleanup old version
if [ -f /usr/local/bin/bsx/update.sh ]; then
    /usr/local/bin/bsx/update.sh
    cd /usr/local/bin
    sudo rm -rf basicswap-bash bsx*
fi

# Download updated scripts
echo "Updating basicswap-bash scripts" && sleep 1

cd $SWAP_DATADIR/basicswap
if [[ -d basicswap-bash ]]; then
    cd basicswap-bash
    git pull || {
        $red"Failed to update repo. Cancelling update.\n"
        exit
    }
else
    git clone https://github.com/nahuhh/basicswap-bash || {
        $red"Failed to clone repo. Cancelling update.\n"
        exit
    }
    cd basicswap-bash
fi

# Move scripts
rm -rf $HOME/.local/bin/bsx $HOME/.local/bin/basicswap-bash
cp -r basic* bsx* $HOME/.local/bin/;
# Update BasicSwap, coincurve and coin cores
$HOME/.local/bin/bsx/update.sh
