#!/bin/bash
source $HOME/.local/bin/bsx/shared.sh

if [[ $1 = "--force" ]]; then
    green "Force updating"
else
    is_running
fi
is_tails

# Cleanup old version
if [ -f /usr/local/bin/bsx/update.sh ]; then
    /usr/local/bin/bsx/update.sh
    cd /usr/local/bin
    sudo rm -rf basicswap-bash bsx*
fi

# Download updated scripts
echo "Updating basicswap-bash scripts" && sleep 1

cd $SWAP_DATADIR/basicswap || {
    red "Cannot find datadir. Update failed\n"
    exit
}
if [[ -d basicswap-bash ]]; then
    cd basicswap-bash
    git pull || {
        red "Failed to update repo. Cancelling update.\n"
        exit
    }
else
    git clone https://github.com/nahuhh/basicswap-bash -b localtor || {
        red "Failed to clone repo. Cancelling update.\n"
        exit
    }
    cd basicswap-bash
fi

# Cleanup old
[[ -f $HOME/.local/bin/install.sh ]] && rm $HOME/.local/bin/install.sh

# Move scripts
rm -r $HOME/.local/bin/bsx $HOME/.local/bin/basicswap-*
cp -r basicswap-bash bsx* $HOME/.local/bin/. ;

# Update BasicSwap, coincurve and coin cores
$HOME/.local/bin/bsx/update.sh
